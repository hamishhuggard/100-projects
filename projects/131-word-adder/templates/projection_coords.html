<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Projection Coordinates</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
/* General container styles */
body {
    font-family: 'Arial', sans-serif;
    margin: 0;
    padding: 0;
    background-color: #f9f9f9;
    color: #333;
}

h1 {
    text-align: center;
    font-size: 2rem;
    color: #444;
    margin-top: 20px;
}

/* Layout: form and chart container */
.chart-and-controls {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    align-items: flex-start;
    gap: 30px;
    margin: 20px;
    padding: 20px;
}

/* Controls (form) styles */
.controls {
    flex: 1;
    min-width: 300px;
    max-width: 400px;
    background-color: #fff;
    border: 1px solid #ddd;
    border-radius: 10px;
    padding: 20px;
    box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.1);
}

.controls form {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.controls label {
    display: block;
    font-weight: bold;
    color: #555;
}

.controls input, 
.controls textarea {
    width: 100%;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 5px;
    font-size: 14px;
    box-sizing: border-box;
}

.controls button {
    display: block;
    width: 100%;
    padding: 10px;
    font-size: 16px;
    background-color: #0078d4;
    color: #fff;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s;
}

.controls button:hover {
    background-color: #005bb5;
}

/* Container Styling */
.controls {
    flex: 1;
    min-width: 300px;
    max-width: 400px;
    background-color: #fff;
    border: 1px solid #ddd;
    border-radius: 10px;
    padding: 20px;
    box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.1);
}

/* Row Layout */
.form-row {
    display: flex;
    align-items: center; /* Align label and inputs */
    justify-content: space-between; /* Space out label vs inputs */
    margin-bottom: 10px; /* Add space between rows */
}

/* Align Label */
.axis-label {
    font-weight: bold;
    margin-right: 10px;
	width: 100px;
}

/* Group inputs and text "to" together */
.input-group {
    display: flex;
    align-items: center;
    gap: 5px; /* Space between inputs and "to" */
}

/* Styling Inputs */
.controls input {
    width: 80px; /* Fixed width for neat alignment */
    padding: 5px;
    border: 1px solid #ddd;
    border-radius: 5px;
    font-size: 14px;
}

.controls span {
    font-size: 14px; /* Ensure text "to" aligns */
}

.controls textarea {
    width: 100%;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 5px;
    font-size: 14px;
    box-sizing: border-box;
}

/* Button Styling */
.controls button {
    display: block;
    width: 100%;
    padding: 10px;
    font-size: 16px;
    background-color: #0078d4;
    color: #fff;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s;
}

}

/* Group inputs and text "to" together */
.input-group {
    display: flex;
    align-items: center;
    gap: 5px; /* Space between inputs and "to" */
}

/* Styling Inputs */
.controls input {
    width: 80px; /* Fixed width for neat alignment */
    padding: 5px;
    border: 1px solid #ddd;
    border-radius: 5px;
    font-size: 14px;
}

.controls span {
    font-size: 14px; /* Ensure text "to" aligns */
}

.controls textarea {
    width: 100%;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 5px;
    font-size: 14px;
    box-sizing: border-box;
}

/* Button Styling */
.controls button {
    display: block;
    width: 100%;
    padding: 10px;
    font-size: 16px;
    background-color: #0078d4;
    color: #fff;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s;
}


/* Chart container styles */
#chart {
    flex: 2;
    min-width: 300px;
    max-width: 600px;
    background-color: #fff;
    border: 1px solid #ddd;
    border-radius: 10px;
    padding: 20px;
    box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.1);
    display: flex;
    justify-content: center;
    align-items: center;
}

svg {
    border: 1px solid #ddd;
    border-radius: 5px;
	padding-top: 20px;
}

/* Axis and labels */
.axis { 
    font: 12px sans-serif; 
}

.axis path,
.axis line {
    stroke: #aaa;
    shape-rendering: crispEdges;
}

.axis-label {
    font-size: 14px;
    font-weight: bold;
    fill: #555;
    text-anchor: middle;
}

/* Grid lines */
.grid-line,
.grid-line-h {
    stroke: #eee;
    stroke-dasharray: 2, 2;
}

/* Dots and labels */
.dot {
    stroke: #000;
    fill: #0078d4;
}

.label {
    font-size: 10px;
    text-anchor: middle;
    fill: #333;
}

/* Responsive design */
@media (max-width: 600px) {
    .chart-and-controls {
        flex-direction: column;
        align-items: center;
    }

    .controls, #chart {
        max-width: 100%;
    }
}

    </style>
</head>
<body>
    <h1>Projection Coordinates</h1>


    <div class="chart-and-controls">

    <div id="chart"></div>

    <div class="controls">
		<form id="projection-form">
			<!-- X-axis Row -->
			<div class="form-row">
				<label class="axis-label" for="word_x">x-axis:</label>
				<div class="input-group">
					<input type="text" id="word_x" name="word_x" value="easy">
					<span>to</span>
					<input type="text" id="word_neg_x" name="word_neg_x" value="difficult">
				</div>
			</div>

			<!-- Y-axis Row -->
			<div class="form-row">
				<label class="axis-label" for="word_y">y-axis:</label>
				<div class="input-group">
					<input type="text" id="word_y" name="word_y" value="tasty">
					<span>to</span>
					<input type="text" id="word_neg_y" name="word_neg_y" value="gross">
				</div>
			</div>

            <label for="points">Word list:</label>
            <textarea id="points" name="content" rows="6" cols="40">
pineapple
grape
peach
strawberry
blueberry
cherry
pear
apple
banana
tomato
watermelon
pomegranate
grapefruit
orange
lemon </textarea><br>

            <button type="button" id="update-plot">Update Plot</button>
        </form>
    </div>
    
	<div class="content">
<h2>What is this?</h2>
<img src="../static/explanation.png" style="width: 800px; max-width: 100%;" alt="1. Embed words in a 200-dimensional vector space with FastText.
2. Project the word list onto the line connecting the x-positive and x-negative word vectors. This gives the x-coordinates for the word list.
3. Project the word list onto the line connecting the y-positive and y-negative word vectors. This gives the y-coordinates for the word list.
4. Plot the word list with these x and y coorindates."/>
<p>The demo is inspired by <a href="https://xkcd.com/388/">XKCD</a>.</p>
	</div>

</div>

    <script>

const countries = `
USA
UK
Canada
Australia
India
China
Germany
France
Italy
Spain
Japan
Brazil
Russia
Mexico
Argentina
Egypt
Turkey
Nigeria
Indonesia
Vietnam
Thailand
Colombia
Poland
Ukraine
Sweden
Norway
Belgium
Netherlands
NZ`
"north"
"south"
"east"
"west"

const disciplines = `Physics
Psychology
Mathematics
Philosophy
History
Humanities
Sociology
Biology
Chemistry
Anthropology
Economics
Political Science
Linguistics
Art History
Literature
Cultural Studies
Law
Environmental Science
Geography
Theology
Education
Music
Architecture
Engineering
Neuroscience
Social Work
Gender Studies
Archaeology
Public Health
Medicine`
"schizophrenic"
"autistic"
"OCD"
"ADHD"

const margin = { top: 20, right: 30, bottom: 40, left: 50 };
const width = 600 - margin.left - margin.right;
const height = 600 - margin.top - margin.bottom;

const svg = d3.select("#chart")
	.append("svg")
	.attr("width", width + margin.left + margin.right)
	.attr("height", height + margin.top + margin.bottom)
	.append("g")
	.attr("transform", `translate(${margin.left},${margin.top})`);

const xScale = d3.scaleLinear().domain([-7, 7]).range([0, width]);
const yScale = d3.scaleLinear().domain([-7, 7]).range([height, 0]);

svg.append("g")
	.attr("transform", `translate(0,${height / 2})`)
	.call(d3.axisBottom(xScale).ticks(10))
	.attr("class", "axis");

svg.append("g")
	.attr("transform", `translate(${width / 2},0)`)
	.call(d3.axisLeft(yScale).ticks(10))
	.attr("class", "axis");

svg.selectAll(".grid-line")
	.data(d3.range(-7, 8))
	.join("line")
	.attr("class", "grid-line")
	.attr("stroke", "#ccc")
	.attr("x1", d => xScale(d))
	.attr("x2", d => xScale(d))
	.attr("y1", 0)
	.attr("y2", height)
	.style("stroke-width", 0.5);

svg.selectAll(".grid-line-h")
	.data(d3.range(-7, 8))
	.join("line")
	.attr("class", "grid-line-h")
	.attr("stroke", "#ccc")
	.attr("y1", d => yScale(d))
	.attr("y2", d => yScale(d))
	.attr("x1", 0)
	.attr("x2", width)
	.style("stroke-width", 0.5);

function updateAxisLabels(wordX, wordNegX, wordY, wordNegY) {
    svg.select("#axis-label-positive-x").text(wordX.toUpperCase());
    svg.select("#axis-label-negative-x").text(wordNegX.toUpperCase());
    svg.select("#axis-label-positive-y").text(wordY.toUpperCase());
    svg.select("#axis-label-negative-y").text(wordNegY.toUpperCase());
}

// Add class names to the labels for easy selection
svg.append("text")
    .attr("class", "axis-label")
    .attr("id", "axis-label-positive-x")
    .attr("x", width)
    .attr("y", yScale(0)-6)
    .style("font-size", "12px")
    .text("Positive X");

svg.append("text")
    .attr("class", "axis-label")
    .attr("id", "axis-label-negative-x")
    .attr("x", 0)
    .attr("y", yScale(0)-6)
    .style("font-size", "12px")
    .text("Negative X");

svg.append("text")
    .attr("class", "axis-label")
    .attr("id", "axis-label-positive-y")
    .attr("x", xScale(0))
    .attr("y", -10)
    .attr("text-anchor", "middle")
    .style("font-size", "12px")
    .text("Positive Y");

svg.append("text")
    .attr("class", "axis-label")
    .attr("id", "axis-label-negative-y")
    .attr("x", xScale(0))
    .attr("y", height + 20)
    .attr("text-anchor", "middle")
    .style("font-size", "12px")
    .text("Negative Y");


function renderAxisLabels(wordX, wordNegX, wordY, wordNegY) {
    // Remove any existing axis labels
    svg.selectAll(".axis-label").remove();

    // Add positive x-axis label
    svg.append("text")
        .attr("class", "axis-label")
        .attr("x", xScale(xScale.domain()[1]) + 10) // Position slightly to the right
        .attr("y", yScale(0) + 5) // Align with the x-axis
        .attr("text-anchor", "start")
        .style("font-size", "12px")
        .style("fill", "black")
        .text(wordX);

    // Add negative x-axis label
    svg.append("text")
        .attr("class", "axis-label")
        .attr("x", xScale(xScale.domain()[0]) - 10) // Position slightly to the left
        .attr("y", yScale(0) + 5)
        .attr("text-anchor", "end")
        .style("font-size", "12px")
        .style("fill", "black")
        .text(wordNegX);

    // Add positive y-axis label
    svg.append("text")
        .attr("class", "axis-label")
        .attr("x", xScale(0) - 10) // Align with the y-axis
        .attr("y", yScale(yScale.domain()[1]) - 10) // Position slightly above
        .attr("text-anchor", "middle")
        .style("font-size", "12px")
        .style("fill", "black")
        .text(wordY);

    // Add negative y-axis label
    svg.append("text")
        .attr("class", "axis-label")
        .attr("x", xScale(0) - 10)
        .attr("y", yScale(yScale.domain()[0]) + 20) // Position slightly below
        .attr("text-anchor", "middle")
        .style("font-size", "12px")
        .style("fill", "black")
        .text(wordNegY);
}



function renderPoints(points) {
    // Update the scales based on the new data
    xScale.domain(d3.extent(points, d => d.x)).nice();
    yScale.domain(d3.extent(points, d => d.y)).nice();

    // Update and render the dots
    const dots = svg.selectAll(".dot").data(points, d => d.word);

    dots.enter()
        .append("circle")
        .attr("class", "dot")
        .attr("cx", d => xScale(d.x))
        .attr("cy", d => yScale(d.y))
        .attr("r", 5)
        .style("fill", "steelblue");

    dots.transition()
        .duration(1000)
        .attr("cx", d => xScale(d.x))
        .attr("cy", d => yScale(d.y));

    dots.exit().remove();

    // Update and render the labels
    const labels = svg.selectAll(".label").data(points, d => d.word);

    labels.enter()
        .append("text")
        .attr("class", "label")
        .attr("x", d => xScale(d.x))
        .attr("y", d => yScale(d.y) - 10)
        .text(d => d.word);

    labels.transition()
        .duration(1000)
        .attr("x", d => xScale(d.x))
        .attr("y", d => yScale(d.y) - 10)
        .text(d => d.word);

    labels.exit().remove();

    // Update the axes with transitions
    svg.select(".x-axis")
        .transition()
        .duration(1000)
        .call(d3.axisBottom(xScale));

    svg.select(".y-axis")
        .transition()
        .duration(1000)
        .call(d3.axisLeft(yScale));
}

// Define the async function in the outer scope
async function updateChart() {
    const formData = new FormData(document.getElementById("projection-form"));
    const wordX = formData.get("word_x");
    const wordNegX = formData.get("word_neg_x");
    const wordY = formData.get("word_y");
    const wordNegY = formData.get("word_neg_y");

    try {
        const response = await fetch('/projection_coords', {
            method: 'POST',
            body: formData
        });

        if (!response.ok) {
            const errorData = await response.json();
            document.getElementById('response').textContent = JSON.stringify(errorData, null, 2);
            throw new Error(`HTTP error! status: ${response.status}`);
        }

        const data = await response.json(); // Parse the response as JSON
        renderPoints(data);
        updateAxisLabels(wordX, wordNegX, wordY, wordNegY);
    } catch (error) {
        document.getElementById('response').textContent = `Error: ${error.message}`;
    }
}

// Call the function immediately on page load
updateChart();

// Also attach it to the button click event
document.getElementById("update-plot").addEventListener("click", updateChart);



    </script>
</body>
</html>
